# Sierra Sync Database Replication Configuration
# Configuration file for multi-region database replication management

# Primary database configuration
PRIMARY_REGION="us-east-1"
PRIMARY_INSTANCE="sierra-sync-primary"
PRIMARY_INSTANCE_CLASS="db.r6g.xlarge"

# Secondary replica configuration (US West)
SECONDARY_REGION="us-west-2"
SECONDARY_INSTANCE="sierra-sync-secondary"
SECONDARY_INSTANCE_CLASS="db.r6g.large"

# Tertiary replica configuration (Europe)
TERTIARY_REGION="eu-west-1"
TERTIARY_INSTANCE="sierra-sync-tertiary"
TERTIARY_INSTANCE_CLASS="db.r6g.large"

# Database settings
DB_ENGINE="postgres"
DB_ENGINE_VERSION="15.4"
DB_NAME="sierra_sync"
DB_USERNAME="sierra_admin"

# Storage configuration
ALLOCATED_STORAGE="500"
MAX_ALLOCATED_STORAGE="2000"
STORAGE_TYPE="gp3"
STORAGE_ENCRYPTED="true"

# Backup and maintenance
BACKUP_RETENTION_PERIOD="30"
BACKUP_WINDOW="03:00-04:00"
MAINTENANCE_WINDOW="sun:04:00-sun:05:00"
FINAL_SNAPSHOT_IDENTIFIER_PREFIX="sierra-sync-final-snapshot"

# Performance and monitoring
MONITORING_INTERVAL="60"
PERFORMANCE_INSIGHTS_ENABLED="true"
PERFORMANCE_INSIGHTS_RETENTION="7"
ENHANCED_MONITORING_ENABLED="true"

# CloudWatch logs
ENABLED_CLOUDWATCH_LOGS="postgresql,upgrade"

# Replication settings
MAX_REPLICA_LAG_SECONDS="300"
REPLICATION_HEALTH_CHECK_INTERVAL="300"

# Security settings
DELETION_PROTECTION="true"
COPY_TAGS_TO_SNAPSHOT="true"

# VPC and networking
VPC_CIDR_PRIMARY="10.0.0.0/16"
VPC_CIDR_SECONDARY="10.1.0.0/16"
VPC_CIDR_TERTIARY="10.2.0.0/16"

# Subnet CIDRs
SUBNET_PRIVATE_1_CIDR_PRIMARY="10.0.1.0/24"
SUBNET_PRIVATE_2_CIDR_PRIMARY="10.0.2.0/24"
SUBNET_PRIVATE_1_CIDR_SECONDARY="10.1.1.0/24"
SUBNET_PRIVATE_2_CIDR_SECONDARY="10.1.2.0/24"
SUBNET_PRIVATE_1_CIDR_TERTIARY="10.2.1.0/24"
SUBNET_PRIVATE_2_CIDR_TERTIARY="10.2.2.0/24"

# Route53 configuration
PRIVATE_HOSTED_ZONE="sierra-sync.internal"
DB_PRIMARY_RECORD="db-primary.sierra-sync.internal"
DB_SECONDARY_RECORD="db-secondary.sierra-sync.internal"
DB_TERTIARY_RECORD="db-tertiary.sierra-sync.internal"
DB_READ_RECORD="db-read.sierra-sync.internal"

# Alerting and notifications
SLACK_WEBHOOK_URL="${SLACK_WEBHOOK_URL:-}"
EMAIL_NOTIFICATIONS="${EMAIL_NOTIFICATIONS:-admin@sierrasync.com}"

# CloudWatch alarm thresholds
CPU_ALARM_THRESHOLD="80"
CONNECTIONS_ALARM_THRESHOLD="160"
REPLICA_LAG_ALARM_THRESHOLD="300"
FREE_STORAGE_ALARM_THRESHOLD="20"  # GB

# Auto-scaling settings (for Aurora clusters if needed)
MIN_CAPACITY="2"
MAX_CAPACITY="64"
AUTO_PAUSE_ENABLED="false"
SECONDS_UNTIL_AUTO_PAUSE="300"

# Disaster recovery settings
CROSS_REGION_BACKUP_ENABLED="true"
POINT_IN_TIME_RECOVERY_ENABLED="true"
AUTOMATED_BACKUP_ENABLED="true"

# Parameter group settings
PARAMETER_GROUP_FAMILY="postgres15"
PARAMETER_GROUP_NAME="sierra-sync-postgres-params"

# Custom PostgreSQL parameters
PG_LOG_STATEMENT="all"
PG_LOG_MIN_DURATION="1000"
PG_SHARED_PRELOAD_LIBRARIES="pg_stat_statements"
PG_MAX_CONNECTIONS="200"
PG_SHARED_BUFFERS="{DBInstanceClassMemory/4}"
PG_EFFECTIVE_CACHE_SIZE="{DBInstanceClassMemory*3/4}"
PG_MAINTENANCE_WORK_MEM="2097152"
PG_CHECKPOINT_COMPLETION_TARGET="0.9"
PG_WAL_BUFFERS="16384"
PG_DEFAULT_STATISTICS_TARGET="100"

# Terraform state configuration
TERRAFORM_STATE_BUCKET="sierra-sync-terraform-state"
TERRAFORM_STATE_KEY="database/multi-region/terraform.tfstate"
TERRAFORM_STATE_REGION="us-east-1"
TERRAFORM_LOCK_TABLE="sierra-sync-terraform-locks"

# AWS CLI profiles (optional)
AWS_PROFILE_PRIMARY="${AWS_PROFILE_PRIMARY:-default}"
AWS_PROFILE_SECONDARY="${AWS_PROFILE_SECONDARY:-default}"
AWS_PROFILE_TERTIARY="${AWS_PROFILE_TERTIARY:-default}"

# Logging configuration
LOG_LEVEL="INFO"
LOG_FILE="/var/log/sierra-sync/db-replication.log"
LOG_ROTATION_SIZE="100M"
LOG_RETENTION_DAYS="30"

# Health check configuration
HEALTH_CHECK_TIMEOUT="30"
HEALTH_CHECK_RETRIES="3"
HEALTH_CHECK_INTERVAL="60"

# Connection pool settings (for application configuration)
DB_POOL_MIN_SIZE="5"
DB_POOL_MAX_SIZE="20"
DB_POOL_ACQUIRE_TIMEOUT="30000"
DB_POOL_CREATE_TIMEOUT="30000"
DB_POOL_DESTROY_TIMEOUT="5000"
DB_POOL_IDLE_TIMEOUT="30000"
DB_POOL_REAP_INTERVAL="1000"

# SSL/TLS configuration
DB_SSL_MODE="require"
DB_SSL_CERT_PATH="/etc/ssl/certs/rds-ca-2019-root.pem"

# Maintenance and operations
MAINTENANCE_NOTIFICATION_ADVANCE_HOURS="24"
SCHEDULED_MAINTENANCE_DAY="sunday"
SCHEDULED_MAINTENANCE_TIME="04:00"

# Feature flags
ENABLE_AUTOMATED_FAILOVER="false"  # Manual failover for safety
ENABLE_CROSS_REGION_ENCRYPTION="true"
ENABLE_DETAILED_MONITORING="true"
ENABLE_QUERY_LOGGING="true"
ENABLE_SLOW_QUERY_LOGGING="true"

# Cost optimization
ENABLE_STORAGE_AUTOSCALING="true"
ENABLE_PERFORMANCE_INSIGHTS="true"
DELETE_AUTOMATED_BACKUPS="false"

# Multi-AZ configuration
MULTI_AZ_ENABLED="true"
PREFERRED_BACKUP_AZ="us-east-1a"
PREFERRED_MAINTENANCE_AZ="us-east-1b"

# Tags for all resources
TAGS_ENVIRONMENT="production"
TAGS_PROJECT="sierra-sync"
TAGS_TEAM="platform"
TAGS_OWNER="devops"
TAGS_COST_CENTER="engineering"
TAGS_BACKUP_REQUIRED="true"
TAGS_COMPLIANCE_REQUIRED="true"